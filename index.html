<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<div id="env-widget" style="
  font-family: 'Inter', Arial, sans-serif;
  padding: 15px;
  border-radius: 10px;
  background: #c99d6c;
  color: #00072d;
  width: 280px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
">
  <h3 id="env-city" style="margin:0 0 5px;">Loading...</h3>
  <p id="env-aqi" style="margin:5px 0; font-size:1.8em; font-weight:bold;">AQI: --</p>
  <p id="env-aqi-level" style="margin:5px 0; font-size:0.9em; padding:5px 10px; border-radius:5px; text-align:center; font-weight:600;">--</p>
  <div style="margin:10px 0; font-size:0.7em;">
    <div style="margin-bottom:3px;"><span style="display:inline-block; width:15px; height:15px; background:#00e400; border-radius:3px; margin-right:5px;"></span>0-50: Good</div>
    <div style="margin-bottom:3px;"><span style="display:inline-block; width:15px; height:15px; background:#ffff00; border-radius:3px; margin-right:5px;"></span>51-100: Moderate</div>
    <div style="margin-bottom:3px;"><span style="display:inline-block; width:15px; height:15px; background:#ff7e00; border-radius:3px; margin-right:5px;"></span>101-150: Unhealthy for Sensitive</div>
    <div style="margin-bottom:3px;"><span style="display:inline-block; width:15px; height:15px; background:#ff0000; border-radius:3px; margin-right:5px;"></span>151-200: Unhealthy</div>
    <div style="margin-bottom:3px;"><span style="display:inline-block; width:15px; height:15px; background:#8f3f97; border-radius:3px; margin-right:5px;"></span>201-300: Very Unhealthy</div>
    <div><span style="display:inline-block; width:15px; height:15px; background:#7e0023; border-radius:3px; margin-right:5px;"></span>301+: Hazardous</div>
  </div>
  <p id="env-uv" style="margin:5px 0; font-size:1.8em; font-weight:bold;">UV Index: --</p>
  <small id="env-updated" style="opacity:0.8;">Updated: --</small>
</div>

<script>
  const aqiToken = "902f87a0a51e5839820aae018e6d08cebfdcd2b8";
  const city = "Kuala Lumpur";
  const lat = 3.139, lon = 101.687;

  async function updateWidget() {
    // Fetch AQI
    const aqiRes = await fetch(`https://api.waqi.info/feed/${city}/?token=${aqiToken}`);
    const aqiData = await aqiRes.json();
    // Fetch UV
    const uvRes = await fetch(`https://currentuvindex.com/api/v1/uvi?latitude=${lat}&longitude=${lon}`);
    const uvData = await uvRes.json();

    const aqiEl = document.getElementById("env-aqi");
    const aqiLevelEl = document.getElementById("env-aqi-level");
    const uvEl = document.getElementById("env-uv");
    const cityEl = document.getElementById("env-city");
    const updEl = document.getElementById("env-updated");

    if (aqiData.status === "ok") {
      const aqi = aqiData.data.aqi;
      aqiEl.textContent = `AQI: ${aqi}`;
      cityEl.textContent = aqiData.data.city.name;
      
      // Determine AQI level and color
      let level, color;
      if (aqi <= 50) {
        level = "Good"; color = "#00e400";
      } else if (aqi <= 100) {
        level = "Moderate"; color = "#ffff00";
      } else if (aqi <= 150) {
        level = "Unhealthy for Sensitive Groups"; color = "#ff7e00";
      } else if (aqi <= 200) {
        level = "Unhealthy"; color = "#ff0000";
      } else if (aqi <= 300) {
        level = "Very Unhealthy"; color = "#8f3f97";
      } else {
        level = "Hazardous"; color = "#7e0023";
      }
      
      aqiLevelEl.textContent = level;
      aqiLevelEl.style.background = color;
      aqiLevelEl.style.color = (aqi <= 100) ? "#000" : "#fff";
    } else {
      aqiEl.textContent = "AQI: N/A";
      aqiLevelEl.textContent = "N/A";
      aqiLevelEl.style.background = "#ccc";
      cityEl.textContent = city;
    }

    if (uvData.ok) {
      uvEl.textContent = `UV Index: ${uvData.now.uvi}`;
    } else {
      uvEl.textContent = "UV Index: N/A";
    }

    updEl.textContent = `Updated: ${new Date().toLocaleTimeString()}`;
  }

  updateWidget();
  setInterval(updateWidget, 30 * 60 * 1000); // refresh every 30 minutes
</script>
